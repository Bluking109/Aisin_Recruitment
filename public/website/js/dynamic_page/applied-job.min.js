let recaptchaReset = function(action) {
    grecaptcha.ready(function() {
        grecaptcha.execute(siteKey, {action: action}).then(function(token) {
            $('#btn-update').prop('disabled', false);
            $('#recaptcha-key').val(token);
        });
    });
}

const prepareSubmit = function () {
    $('#btn-update').find('.submit-text').hide();
    $('#btn-update').find('.loading').css('display', 'inline-block');
    $('#btn-update').prop('disabled', true);
}

const afterSubmit = function () {
    $('#btn-update').find('.submit-text').show();
    $('#btn-update').find('.loading').css('display', 'none');
    $('.error-update').remove();

    setTimeout(function(){
        $('#btn-update').prop('disabled', false);
    }, 3000);
}

const getRegions = function(url, element, param = null, child = null) {
    let query = buildQuery(param);
    let elementValue = $(element).val();
    $.ajax({
        url: url + '?' + query,
        type: 'GET',
        dataType: "json",
        success: function (data) {
            let opt = '';
            data.forEach((v) => {
                let selected  = '';
                if (v.id == elementValue) {
                    selected = 'selected';
                }
                opt += `<option value="${v.id}" ${selected}>${v.text}</option>`
            });

            $(element).chosen('destroy').empty().append(opt);
            $(element).chosen();

            let childId = $(element).data('child');

            if (childId != null && childId != undefined) {
                let attributChild = $(element).data('parent-param');
                let valueChild = $(element).val();
                getRegions($(element).data('child-url'), childId, {[attributChild] : valueChild})
            }
        },
        statusCode: {
            500 : function (data) {
                console.log('Internal Server Error')
            }
        }
    });
}

const buildQuery = function (data) {
    if (typeof (data) === 'string') return data;

    var query = [];

    for (var key in data) {
        if (data.hasOwnProperty(key)) {
            query.push(encodeURIComponent(key) + '=' + encodeURIComponent(data[key]));
        }
    }

    return query.join('&');
};

const datePickerInit = function() {
    $('.datepicker').datepicker({
        format: 'dd-mm-yyyy',
        autoclose: true,
        orientation: "bottom"
    });
}

$(function() {
    if ($(window).width() < 800) {
        if (localStorage.getItem('keep_use_device') != 1) {
            Swal.fire({
              title: 'Device Kurang Lebar :(',
              text: "Demi kemudahan Anda, untuk pengisian form kami sarankan menggunakan laptop atau komputer",
              type: 'info',
              showCancelButton: true,
              confirmButtonColor: '#3085d6',
              cancelButtonColor: '#ccc',
              confirmButtonText: 'Gunakan device ini',
              cancelButtonText: 'Tutup',
            }).then((result) => {
              if (result.value) {
                localStorage.setItem('keep_use_device','1');
              }
            })
        }
    }

    datePickerInit();

    $('.year-input').datepicker({
        format: 'yyyy',
        viewMode: "years",
        minViewMode: "years",
        autoclose: true,
        orientation: "bottom"
    });
});
$(function() {
	if (localStorage.getItem('success_confirmation')) {
		Toast.fire({
		    type: 'success',
		    title: localStorage.getItem('success_confirmation_message')
		});

		localStorage.removeItem('success_confirmation');
		localStorage.removeItem('success_confirmation_message');
	}

	$('.confirm-stage').on('click', function() {
		let id = $(this).data('id');
		let status = $(this).data('status');
		let message = 'Anda akan menolak untuk menghadiri test ini';

		if (status == '1') {
			message = 'Anda akan menyetujui untuk menghadiri test ini';
		}

		Swal.fire({
	        title: 'Apakah Anda Yakin?',
	        text: message,
	        type: 'info',
	        showCancelButton: true,
	        confirmButtonColor: '#3085d6',
	        cancelButtonColor: '#ccc',
	        confirmButtonText: 'Ya, Saya Yakin',
	        cancelButtonText: 'Cancel',
        }).then((result) => {
	        if (result.value) {
	        	$.ajax({
			        url: '/profiles/applied-jobs/'+id,
			        type: 'PUT',
			        data: {
			        	status : status,
			        	_token : $('#token-confirmation').val()
			        },
			        success: function (data) {
			        	if (data.success) {
			        		localStorage.setItem('success_confirmation', true);
			        		localStorage.setItem('success_confirmation_message', data.message);
			        		location.reload();
			        	}
			        },
			        statusCode: {
			        	400 : function (data) {
			        		Toast.fire({
							    type: 'error',
							    title: data.responseJSON.message
							});
			        	},
			            500 : function (data) {
			            	Toast.fire({
							    type: 'error',
							    title: 'Internal server error'
							});
			            }
			        }
			    });
	        }
        })
	});
});