let recaptchaReset=function(e){grecaptcha.ready(function(){grecaptcha.execute(siteKey,{action:e}).then(function(e){$("#btn-update").prop("disabled",!1),$("#recaptcha-key").val(e)})})};const prepareSubmit=function(){$("#btn-update").find(".submit-text").hide(),$("#btn-update").find(".loading").css("display","inline-block"),$("#btn-update").prop("disabled",!0)},afterSubmit=function(){$("#btn-update").find(".submit-text").show(),$("#btn-update").find(".loading").css("display","none"),$(".error-update").remove(),setTimeout(function(){$("#btn-update").prop("disabled",!1)},3e3)},getRegions=function(e,t,n=null,r=null){let o=buildQuery(n),i=$(t).val();$.ajax({url:e+"?"+o,type:"GET",dataType:"json",success:function(e){let n="";e.forEach(e=>{let t="";e.id==i&&(t="selected"),n+=`<option value="${e.id}" ${t}>${e.text}</option>`}),$(t).chosen("destroy").empty().append(n),$(t).chosen();let r=$(t).data("child");if(null!=r&&null!=r){let e=$(t).data("parent-param"),n=$(t).val();getRegions($(t).data("child-url"),r,{[e]:n})}},statusCode:{500:function(e){console.log("Internal Server Error")}}})},buildQuery=function(e){if("string"==typeof e)return e;var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")},datePickerInit=function(){$(".datepicker").datepicker({format:"dd-mm-yyyy",autoclose:!0,orientation:"bottom"})};$(function(){$(window).width()<800&&1!=localStorage.getItem("keep_use_device")&&Swal.fire({title:"Device Kurang Lebar :(",text:"Demi kemudahan Anda, untuk pengisian form kami sarankan menggunakan laptop atau komputer",type:"info",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#ccc",confirmButtonText:"Gunakan device ini",cancelButtonText:"Tutup"}).then(e=>{e.value&&localStorage.setItem("keep_use_device","1")}),datePickerInit(),$(".year-input").datepicker({format:"yyyy",viewMode:"years",minViewMode:"years",autoclose:!0,orientation:"bottom"})}),$(function(){recaptchaReset("work_experience"),datePickerInit(),$("#work-experience-form").on("click",".add-work-experience",function(){let e=$(this).closest("form").find(".work-experience-row");if(e.length>=4)return;let t=e.last().clone(),n=parseInt(t.data("index"))+1;t.find("input, textarea").val(""),t.find(".work-experience-company").attr("name",`work_experiences[${n}][company]`),t.find(".work-experience-position").attr("name",`work_experiences[${n}][position]`),t.find(".work-experience-salary").attr("name",`work_experiences[${n}][salary]`),t.find(".work-experience-join-date").attr("name",`work_experiences[${n}][join_date]`),t.find(".work-experience-end-date").attr("name",`work_experiences[${n}][end_date]`),t.find(".work-experience-reason-out").attr("name",`work_experiences[${n}][reason_to_move]`),t.find(".work-experience-boss-name").attr("name",`work_experiences[${n}][boss_name]`),t.find(".work-experience-boss-position").attr("name",`work_experiences[${n}][boss_position]`),t.find(".work-experience-subordinate-total").attr("name",`work_experiences[${n}][number_of_subordinates]`),t.attr("data-index",n),t.appendTo("#work-experience-form"),datePickerInit(),cleaveJsInit()}),$("#work-experience-form").on("click",".remove-work-experience",function(){$(this).closest("form").find(".work-experience-row").length<2||$(this).closest(".work-experience-row").remove()}),$("#btn-update").on("click",function(e){e.preventDefault(),$("#btn-update").find(".submit-text").hide(),$("#btn-update").find(".loading").css("display","inline-block"),$("#btn-update").prop("disabled",!0);let t=$("#work-experience-form, #work-experience-detail-form");$.ajax({url:"/profiles/work-experience",type:"PUT",data:t.serialize(),success:function(e){e.success&&(Toast.fire({type:e.type,title:e.message}),recaptchaReset("work_experience"),afterSubmit()),afterSubmit()},statusCode:{422:function(e){recaptchaReset("work_experience"),afterSubmit(),Toast.fire({type:"error",title:"Mohon koreksi ulang inputan Anda"});let n=e.responseJSON.errors;for(error in n){let e=error.split("."),r="";e.length>1?(e.forEach((t,n)=>{n!=e.length&&(r+=0==n?t+"[":t+"][")}),r=r.slice(0,-1)):r=error,t.find('[name="'+r+'"]').after(`<span class="text-danger error-update">${n[error].join(". ")}</span>`)}},400:function(e){Toast.fire({type:"error",title:e.responseJSON.message}),recaptchaReset("work_experience"),afterSubmit()},500:function(e){Toast.fire({type:"error",title:"Internal server error"}),recaptchaReset("work_experience"),afterSubmit()}}})})});
