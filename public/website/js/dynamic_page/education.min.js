let recaptchaReset=function(e){grecaptcha.ready(function(){grecaptcha.execute(siteKey,{action:e}).then(function(e){$("#btn-update").prop("disabled",!1),$("#recaptcha-key").val(e)})})};const prepareSubmit=function(){$("#btn-update").find(".submit-text").hide(),$("#btn-update").find(".loading").css("display","inline-block"),$("#btn-update").prop("disabled",!0)},afterSubmit=function(){$("#btn-update").find(".submit-text").show(),$("#btn-update").find(".loading").css("display","none"),$(".error-update").remove(),setTimeout(function(){$("#btn-update").prop("disabled",!1)},3e3)},getRegions=function(e,t,n=null,a=null){let o=buildQuery(n),r=$(t).val();$.ajax({url:e+"?"+o,type:"GET",dataType:"json",success:function(e){let n="";e.forEach(e=>{let t="";e.id==r&&(t="selected"),n+=`<option value="${e.id}" ${t}>${e.text}</option>`}),$(t).chosen("destroy").empty().append(n),$(t).chosen();let a=$(t).data("child");if(null!=a&&null!=a){let e=$(t).data("parent-param"),n=$(t).val();getRegions($(t).data("child-url"),a,{[e]:n})}},statusCode:{500:function(e){console.log("Internal Server Error")}}})},buildQuery=function(e){if("string"==typeof e)return e;var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")};$(function(){$(".datepicker").datepicker({format:"dd-mm-yyyy",autoclose:!0,orientation:"bottom"}),$(".year-input").datepicker({format:"yyyy",viewMode:"years",minViewMode:"years",autoclose:!0,orientation:"bottom"})});const initRangeMonthDatePicker=function(){[{firstDatePicker:".month-year-input-in",lastDatePicker:".month-year-input-out",format:"mm-yyyy",viewMode:"months"},{firstDatePicker:".non-formal-from-date",lastDatePicker:".non-formal-until-date",format:"dd-mm-yyyy",viewMode:"dates"},{firstDatePicker:".tenure-from-date",lastDatePicker:".tenure-end-date",format:"dd-mm-yyyy",viewMode:"dates"}].forEach(e=>{$(e.lastDatePicker).datepicker({format:e.format,viewMode:e.viewMode,minViewMode:e.viewMode,autoclose:!0,orientation:"bottom"}).on("changeDate",function(t){$(e.firstDatePicker).datepicker("setEndDate",t.date)}),$(e.firstDatePicker).datepicker({format:e.format,viewMode:e.viewMode,minViewMode:e.viewMode,autoclose:!0,orientation:"bottom"}).on("changeDate",function(t){$(e.lastDatePicker).datepicker("setStartDate",t.date)})})};$(function(){recaptchaReset("education"),initRangeMonthDatePicker(),$("#non-formal-form").on("click",".add-non-formal",function(){let e=$(this).closest("form").find(".non-formal-row");if(e.length>=5)return;let t=e.last().clone(),n=parseInt(t.data("index"))+1;t.find("input").val(""),t.find(".non-formal-course-name").attr("name",`non_formal_educations[${n}][training_name]`),t.find(".non-formal-place").attr("name",`non_formal_educations[${n}][place]`),t.find(".non-formal-note").attr("name",`non_formal_educations[${n}][note]`),t.find(".non-formal-from-date").attr("name",`non_formal_educations[${n}][start_date]`),t.find(".non-formal-until-date").attr("name",`non_formal_educations[${n}][end_date]`),t.attr("data-index",n),t.appendTo("#non-formal-form"),initRangeMonthDatePicker()}),$("#non-formal-form").on("click",".remove-non-formal",function(){$(this).closest("form").find(".non-formal-row").length<2||$(this).closest(".non-formal-row").remove()}),$("#foreign-lang-form").on("click",".add-non-formal",function(){let e=$(this).closest("form").find(".foreign-lang-row");if(e.length>=5)return;let t=e.last().clone(),n=t.data("index"),a=parseInt(n)+1;t.find('input[type="text"]').val(""),t.find(".foreign-lang-language").attr("name",`languages[${a}][language]`),t.find(".foreign-lang-writing").attr("name",`languages[${a}][writing]`),t.find(".foreign-lang-reading").attr("name",`languages[${a}][reading]`),t.find(".foreign-lang-grammar").attr("name",`languages[${a}][grammar]`),t.attr("data-index",a),t.find(`#writing-bad-${n}`).attr("id",`writing-bad-${a}`),t.find(`#reading-bad-${n}`).attr("id",`reading-bad-${a}`),t.find(`#grammar-bad-${n}`).attr("id",`grammar-bad-${a}`),t.find(`label[for="writing-bad-${n}"]`).attr("for",`writing-bad-${a}`),t.find(`label[for="reading-bad-${n}"]`).attr("for",`reading-bad-${a}`),t.find(`label[for="grammar-bad-${n}"]`).attr("for",`grammar-bad-${a}`),t.find(`#writing-good-${n}`).attr("id",`writing-good-${a}`),t.find(`#reading-good-${n}`).attr("id",`reading-good-${a}`),t.find(`#grammar-good-${n}`).attr("id",`grammar-good-${a}`),t.find(`label[for="writing-good-${n}"]`).attr("for",`writing-good-${a}`),t.find(`label[for="reading-good-${n}"]`).attr("for",`reading-good-${a}`),t.find(`label[for="grammar-good-${n}"]`).attr("for",`grammar-good-${a}`),t.appendTo("#foreign-lang-form")}),$("#foreign-lang-form").on("click",".remove-non-formal",function(){$(this).closest("form").find(".foreign-lang-row").length<2||$(this).closest(".foreign-lang-row").remove()}),$("#btn-update").on("click",function(e){e.preventDefault(),$("#btn-update").find(".submit-text").hide(),$("#btn-update").find(".loading").css("display","inline-block"),$("#btn-update").prop("disabled",!0);let t=$("#formal-education-form, #education-detail-form, #non-formal-form, #foreign-lang-form");$.ajax({url:"/profiles/education",type:"PUT",data:t.serialize(),success:function(e){e.success&&(toastr.success(e.message),recaptchaReset("education"),afterSubmit()),afterSubmit()},statusCode:{422:function(e){recaptchaReset("education"),afterSubmit(),toastr.error("Mohon koreksi ulang inputan Anda");let n=e.responseJSON.errors;for(error in n){let e=error.split("."),a="";e.length>1?(e.forEach((t,n)=>{n!=e.length&&(a+=0==n?t+"[":t+"][")}),a=a.slice(0,-1)):a=error,t.find('[name="'+a+'"]').after(`<span class="text-danger error-update">${n[error].join(". ")}</span>`)}},400:function(e){toastr.error(e.responseJSON.message),recaptchaReset("education"),afterSubmit()},500:function(e){toastr.error("Internal server error"),recaptchaReset("education"),afterSubmit()}}})})});
