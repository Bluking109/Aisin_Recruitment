let recaptchaReset=function(e){grecaptcha.ready(function(){grecaptcha.execute(siteKey,{action:e}).then(function(e){$("#btn-update").prop("disabled",!1),$("#recaptcha-key").val(e)})})};const prepareSubmit=function(){$("#btn-update").find(".submit-text").hide(),$("#btn-update").find(".loading").css("display","inline-block"),$("#btn-update").prop("disabled",!0)},afterSubmit=function(){$("#btn-update").find(".submit-text").show(),$("#btn-update").find(".loading").css("display","none"),$(".error-update").remove(),setTimeout(function(){$("#btn-update").prop("disabled",!1)},3e3)},getRegions=function(e,t,n=null,a=null){let i=buildQuery(n),o=$(t).val();$.ajax({url:e+"?"+i,type:"GET",dataType:"json",success:function(e){let n="";e.forEach(e=>{let t="";e.id==o&&(t="selected"),n+=`<option value="${e.id}" ${t}>${e.text}</option>`}),$(t).chosen("destroy").empty().append(n),$(t).chosen();let a=$(t).data("child");if(null!=a&&null!=a){let e=$(t).data("parent-param"),n=$(t).val();getRegions($(t).data("child-url"),a,{[e]:n})}},statusCode:{500:function(e){console.log("Internal Server Error")}}})},buildQuery=function(e){if("string"==typeof e)return e;var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")};$(function(){$(".datepicker").datepicker({format:"dd-mm-yyyy",autoclose:!0,orientation:"bottom"})}),$(function(){recaptchaReset("personal_identity");getRegions("/ajax/provinces","#province-address"),getRegions("/ajax/provinces","#province-domicile"),$("#btn-update").on("click",function(e){e.preventDefault(),$("#btn-update").find(".submit-text").hide(),$("#btn-update").find(".loading").css("display","inline-block"),$("#btn-update").prop("disabled",!0);let t=$("#personal-identity-form");$.ajax({url:"/profiles/personal-identity",type:"POST",data:new FormData(t[0]),cache:!1,contentType:!1,processData:!1,success:function(e){e.success&&(toastr.success(e.message),recaptchaReset("personal_identity"),afterSubmit())},statusCode:{422:function(e){recaptchaReset("personal_identity"),afterSubmit();let n=e.responseJSON.errors;for(error in n){let e=error.split("."),a="";e.length>1?(e.forEach((t,n)=>{n!=e.length&&(a+=0==n?t+"[":t+"][")}),a=a.slice(0,-1)):a=error,t.find('[name="'+a+'"]').after(`<span class="text-danger error-update">${n[error].join(". ")}</span>`)}},400:function(e){toastr.error(e.responseJSON.message),recaptchaReset("personal_identity"),afterSubmit()},500:function(e){toastr.error("Internal server error"),recaptchaReset("personal_identity"),afterSubmit()}}})}),$("#province-address, #district-address, #sub-district-address, #province-domicile, #district-domicile, #sub-district-domicile").on("change",function(){let e=$(this).data("child"),t=$(this).data("parent-param"),n=$(this).val();getRegions($(this).data("child-url"),e,{[t]:n})}),$("#browse-photo").on("click",function(){$("#photo").trigger("click")}),$("#deleted-photo-icon").on("click",function(e){e.preventDefault(),$("#photo-img").attr("src","/website/images/avatar/avatar.jpg"),$("#photo").val("")}),$("#photo").on("change",function(){var e=this.files[0],t=new FileReader;t.onloadend=function(){$("#photo-img").attr("src",t.result)},e&&t.readAsDataURL(e)}),$(".sim-select").on("change",function(){let e=$(this).prop("checked"),t=$(this).data("id");e?$(t).prop("disabled",!1):$(t).prop("disabled",!0)})});
